!function(e,t){"function"==typeof define&&define.amd?(e.LazyJsonUndoRedo=t(),define(function(){return e.LazyJsonUndoRedo})):"object"==typeof exports?module.exports=t():e.LazyJsonUndoRedo=t()}(this,function(){"use strict";function e(t){var i=e.checkSupport();if("polymer"===i)this.usePolymerShim();else if(!i)throw Error("This environment doesn't support the ES6 Object.observe()");this._history=[],this._whitelists=[],this._blacklists=[],this._globalWhitelist=[],this._globalBlacklist=[],this._pointer=-1,this._recChanges=this._recChanges.bind(this),this.observeTree(t)}var t=0,i=e.prototype;return i.observeTree=function(e,t){e&&"object"==typeof e&&(t=(t||[]).concat([e]),this.observe(e),Object.keys(e).forEach(function(i){"object"==typeof e[i]&&-1===t.indexOf(e[i])&&this._isListenable(e,i)&&this.observeTree(e[i],t)},this))},i.unobserveTree=function(e,t){e&&"object"==typeof e&&(t=(t||[]).concat([e]),this.unobserve(e),Object.keys(e).forEach(function(i){"object"==typeof e[i]&&-1===t.indexOf(e[i])&&this.unobserveTree(e[i])},this))},i.observe=function(e){var t=e.constructor&&e.constructor.observe||Array.isArray(e)?Array.observe:Object.observe;t(e,this._recChanges)},i.unobserve=function(e){var t=e.constructor&&e.constructor.unobserve||Array.isArray(e)?Array.unobserve:Object.unobserve;t(e,this._recChanges)},e.checkSupport=function(){return"function"==typeof Object.observe&&"function"==typeof Array.observe?"native":"object"!=typeof exports&&Platform&&"function"==typeof Platform.performMicrotaskCheckpoint&&"function"==typeof ObjectObserver&&"function"==typeof ArrayObserver?"polymer":!1},i._recChanges=function(e){this._pointer<this._history.length-1&&this._history.splice(this._pointer+1),e.forEach(function(e){if("number"==typeof e)this._history.push(e),++this._pointer;else if(this._isListenable(e.object,e.name)){var t=Object.create(null);Object.keys(e).forEach(function(i){t[i]=e[i]}),this._history.push(t),this.observeTree(e.object),++this._pointer}},this)},i.undo=function(){if(this.rec(),this._pointer<0)return!1;var e=this._history[this._pointer--];if("number"==typeof e){var t=this._history.indexOf(e-1);if(-1!==t){for(;this._pointer!==t;)this._reverseRecord(this._history[this._pointer--]);this._pointer--}}else this._reverseRecord(e)},i.redo=function(){if(this.rec(),this._pointer>=this._history.length-1)return!1;var e=this._history[++this._pointer];if("number"==typeof e){var t=this._history.indexOf(e+1);if(-1!==t)for(;++this._pointer!==t;)this._reverseRecord(this._history[this._pointer])}else this._reverseRecord(e)},i.rec=function(){Object.deliverChangeRecords(this._recChanges)},i._reverseRecord=function(e){if("number"!=typeof e){var t;switch(this.unobserve(e.object),e.type){case"add":e.type="delete",e.oldValue=e.object[e.name],delete e.object[e.name];break;case"update":t=e.object[e.name],e.object[e.name]=e.oldValue,e.oldValue=t;break;case"delete":e.type="add",e.object[e.name]=e.oldValue,delete e.oldValue;break;case"splice":t=Array.prototype.splice.apply(e.object,[e.index,e.addedCount].concat(e.removed)),e.addedCount=e.removed.length,e.removed=t}this.observe(e.object)}},i.startFlag=function(){return this.rec(),this._recChanges([t++]),t++},i.endFlag=function(e){this.rec(),this._recChanges([e])},i.wrap=function(e,t){var i=this;return function(){var s=i.startFlag();e.apply(t,Array.prototype.slice.call(arguments,2)),i.endFlag(s)}},i.setWhitelist=function(e,t){this.removeWhitelist(e),this._whitelists.push({obj:e,list:t})},i.getWhitelist=function(e){for(var t=0,i=this._whitelists.length;i>t;++t)if(this._whitelists[t].obj===e)return this._whitelists[t]},i.removeWhitelist=function(e){for(var t=0;t<this._whitelists.length;++t)this._whitelists[t].obj===e&&this._whitelists.splice(t--,1)},i.setBlacklist=function(e,t){this.removeBlacklist(e),this._blacklists.push({obj:e,list:t})},i.getBlacklist=function(e){for(var t=0,i=this._blacklists.length;i>t;++t)if(this._blacklists[t].obj===e)return this._blacklists[t]},i.removeBlacklist=function(e){for(var t=0;t<this._blacklists.length;++t)this._blacklists[t].obj===e&&this._blacklists.splice(t--,1)},i.addToGlobalWhitelist=function(){for(var e=arguments,t=0,i=e.length;i>t;++t)this._globalWhitelist.push(e[t])},i.removeFromGlobalWhitelist=function(){var e=arguments;this._globalWhitelist=this._globalWhitelist.filter(function(t){return-1===Array.prototype.indexOf.call(e,t)})},i.addToGlobalBlacklist=function(){for(var e=arguments,t=0,i=e.length;i>t;++t)this._globalBlacklist.push(e[t])},i.removeFromGlobalBlacklist=function(){var e=arguments;this._globalBlacklist=this._globalBlacklist.filter(function(t){return-1===Array.prototype.indexOf.call(e,t)})},i._isListenable=function(e,t){var i=this.getWhitelist(e),s=this.getBlacklist(e);return i&&-1===i.list.indexOf(t)?!1:s&&-1!==s.list.indexOf(t)?!1:0!==this._globalWhitelist.length&&-1===this._globalWhitelist.indexOf(t)?!1:-1!==this._globalBlacklist.indexOf(t)?!1:!0},i.usePolymerShim=function(){function e(e){return-1!==o.indexOf(e)}function t(t){if(!e(t)){var i=this,r=new ObjectObserver(t);o.push(t),s.push(r),r.open(function(e,s,o,r){var n=[];Object.keys(e).forEach(function(e){n.push({object:t,type:"add",name:e})}),Object.keys(s).forEach(function(e){n.push({object:t,type:"delete",name:e,oldValue:r(e)})}),Object.keys(o).forEach(function(e){n.push({object:t,type:"update",name:e,oldValue:r(e)})}),i._recChanges(n)})}}function i(t){if(!e(t)){var i=this,r=new ArrayObserver(t);o.push(t),s.push(r),r.open(function(e){e.forEach(function(e){e.object=t,e.type="splice"}),i._recChanges(e)})}}if(!this._isPolymerShimInited){this._isPolymerShimInited=!0,this.usingShim=!0;var s=[],o=[];this.rec=function(){Platform.performMicrotaskCheckpoint()},this.observe=function(e){Array.isArray(e)?i.call(this,e):t.call(this,e)},this.unobserve=function(e){var t=o.indexOf(e);-1!==t&&(o.splice(t,1),s.splice(t,1)[0].close())}}},e});
//# sourceMappingURL=LazyJsonUndoRedo.min.js.map